<div class="row">
    <div class="section">
        <div class="autogrid tabs-block">
            <div class="col here"><a href="#color" data-id="color">Colors</a></div>
            <div class="col"><a href="#image" data-id="image">Images</a></div>
        </div>
    </div>
</div>

<div class="row" id="color">
    <div class="section">
        <div class="autogrid">
            <div class="col">
                <label>
                    <input type="color" id="base-color">
                </label>
            </div>
            <div class="col">
                <label>
                    <input type="color" id="base-color-hover">
                </label>
            </div>
            <div class="col">
                <label>
                    <input type="color" id="background">
                </label>
            </div>
            <div class="col">
                <label>
                    <input type="color" id="background-alt">
                </label>
            </div>
            <div class="col">
                <label>
                    <input type="color" id="border">
                </label>
            </div>
            <div class="col">
                <label>
                    <input type="color" id="heading">
                </label>
            </div>
            <div class="col">
                <label>
                    <input type="color" id="text">
                </label>
            </div>
            <div class="col">
                <label>
                    <button class="btn solid green">Update</button>
                </label>
            </div>
        </div>
    </div>
</div>
<div class="row hide" id="image">
    <div class="section">
        <div class="full-width-forms">

            <div class="col-1-3">
                Select an 1920 x 720 px jpg image
            </div>
            <div class="col-1-3">
                Upload it, visit your site
            </div>
            <div class="col-1-3">
                Consolidate it to finish
            </div>
            <div class="clear"></div>

            <div class="col-1-3">
                <label>
                    <input type="file" id="lead-bg" accept=".jpg">
                </label>
            </div>
            <div class="col-1-3">
                <label>
                    <button class="btn orange" id="lead-bg-upload" disabled>Upload</button>
                </label>
            </div>
            <div class="col-1-3">
                <label>
                    <button class="btn solid green" id="lead-bg-consolidate" disabled>Consolidate</button>
                </label>
            </div>
            <div class="clear"></div>

            <div class="col-1-3">
                Select an favicon.ico
            </div>
            <div class="col-1-3">
                Upload it, visit your site
            </div>
            <div class="col-1-3">
                Consolidate it to finish
            </div>
            <div class="clear"></div>

            <div class="col-1-3">
                <label>
                    <input type="file" id="favicon" accept=".ico">
                </label>
            </div>
            <div class="col-1-3">
                <label>
                    <button class="btn orange" id="favicon-upload" disabled>Upload</button>
                </label>
            </div>
            <div class="col-1-3">
                <label>
                    <button class="btn solid green" id="favicon-consolidate" disabled>Consolidate</button>
                </label>
            </div>
            <div class="clear"></div>

            <div class="col-1-2">
                Resume
            </div>
            <div class="col-1-2">
                Upload it
            </div>
            <div class="col-1-2">
                <label>
                    <textarea id="resume" placeholder="Paste your resume's url" rows="4"></textarea>
                </label>
            </div>
            <div class="col-1-2">
                <label>
                    <button class="btn solid green" id="resume-upload" disabled>Upload</button>
                </label>
            </div>
            <div class="clear"></div>
        </div>
    </div>
</div>
<script>
    const web = PageHelper.prototype.data.web;
    const tabs = PD('.tabs-block div');
    const colorInputs = PD('#color input');
    const resume = PD('textarea#resume');
    const resumeUpload = PD('button#resume-upload');
    const save = () => {
        Request.json('curriculum/set', PageHelper.prototype.data,
            Request.handleError, { AUTH: PageHelper.prototype.token })
            .then(UIHelpers.Loading.close);
    }
    const colorBtn = PD('#color button').listen('click', () => {
        const colors = {};

        UIHelpers.Loading.show();

        colorInputs.getElements().forEach(input => colors[input.id] = input.value);

        PageHelper.prototype.data.web.color = colors;

        save();
    });
    const getBase64 = (file) => {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });
    }
    const consolidate = (index) => {
        delete web.image[index];
        save();
    };

    if (typeof web.image == 'undefined')
        web.image = {};

    PD('.tabs-block a').listen('click', (e) => {
        const a = e.target;
        let showEl = '#image', hideEl = '#color';

        e.preventDefault();

        tabs.removeClass('here');
        a.parentNode.classList.add('here');

        if (a.dataset.id == 'color') {
            showEl = '#color';
            hideEl = '#image';
        }

        PD(hideEl).addClass('hide');
        PD(showEl).removeClass('hide');
    });

    colorInputs.getElements().forEach(el => el.value = web.color[el.id]);

    PD('input[type="file"]').listen('change', (e) => {
        const input = e.target;
        const file = input.files[0];
        const id = input.id;

        PD(`button#${id}-upload`).removeAttribute('disabled')
            .listen('click', () => {

                PD(`button#${id}-consolidate`).removeAttribute('disabled')
                    .listen('click', () => consolidate(id));

                getBase64(file).then((data) => {
                    web.image[id] = data;

                    save();
                });
            });
    });

    resume.listen('change', () => resumeUpload.removeAttribute('disabled'));

    resumeUpload.listen('click', () => {
        web.image.resume = resume.getValue();

        save();
    });
</script>